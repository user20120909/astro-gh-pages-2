---
import weather from '../../public/weather.json';
import { getIcon } from '../util/weather';
import Paragraph from './Paragraph.astro';

interface Props {
  length?: number;
}

const { length } = Astro.props;
---

{
  (() => {
    const items = weather.data.slice(0, length);
    const result = [];
    let bgCounter = 0;

    for (let i = 0; i < items.length; i++) {
      const item = items[i];

      result.push(
        <div class="w-full">
          <a href={`/weer/detail?region=${encodeURIComponent(item.city)}`}>
            <table class="w-full table-fixed">
              <tbody class="w-full">
                <tr
                  class={`w-full ${bgCounter % 2 === 0 ? 'bg-gray-50' : ''} h-20`}
                >
                  {item.ignore ? (
                    <td class="w-full px-2 py-2">
                      <b>ðŸ’¥ {item.city} is vernietegt</b>
                    </td>
                  ) : (
                    <>
                      <td class="w-auto px-2 py-2">
                        <b>{`${getIcon(item.icon)} ${item.city}`}</b>
                      </td>
                      <td class="px-2 py-2 text-right w-1/6 text-gray-800">
                        <div>
                          {item.minTemp}Â°
                          <br />
                          <b>{item.maxTemp}Â°</b>
                        </div>
                      </td>
                      <td class="w-auto px-2 py-2">
                        <span class="text-gray-800" set:html={item.desc} />
                      </td>
                    </>
                  )}
                </tr>
              </tbody>
            </table>
          </a>
        </div>
      );

      bgCounter++;

      // Insert ad after every 11 items
      if ((i + 1) % 11 === 0 && i !== items.length - 1) {
        const adIndex = Math.floor(i / 11);
        result.push(<Paragraph ad={adIndex % 2 === 0 ? 'shop-img' : 'shop'} />);
        bgCounter = 0; // Reset background counter after ad
      }
    }

    return result;
  })()
}
